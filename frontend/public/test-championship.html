<!DOCTYPE html>
<html>
<head>
    <title>Championship Logic Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { color: blue; }
        button { padding: 10px 20px; margin: 10px 5px; font-size: 16px; }
        .results { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ† Championship Wins Logic Test</h1>
    
    <div class="results">
        <h2>í…ŒìŠ¤íŠ¸ ì„¤ëª…</h2>
        <p>ì´ í…ŒìŠ¤íŠ¸ëŠ” championship_wins ì¤‘ë³µ ì¦ê°€ ë¬¸ì œê°€ í•´ê²°ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤:</p>
        <ul>
            <li><strong>ì²« ë²ˆì§¸ API í˜¸ì¶œ</strong>: championship_winsê°€ 1 ì¦ê°€í•´ì•¼ í•¨</li>
            <li><strong>ì¤‘ë³µ API í˜¸ì¶œ</strong>: ê°™ì€ ì„¸ì…˜ìœ¼ë¡œ í˜¸ì¶œí•˜ë©´ ì°¨ë‹¨ë˜ì–´ì•¼ í•¨</li>
            <li><strong>ìƒˆ ì„¸ì…˜ í˜¸ì¶œ</strong>: ë‹¤ë¥¸ ì„¸ì…˜ìœ¼ë¡œ í˜¸ì¶œí•˜ë©´ ë‹¤ì‹œ 1 ì¦ê°€í•´ì•¼ í•¨</li>
        </ul>
    </div>

    <div>
        <button onclick="runClientSideTest()">í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì¤‘ë³µ ë°©ì§€ í…ŒìŠ¤íŠ¸</button>
        <button onclick="clearStorage()">ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™”</button>
    </div>

    <div class="results">
        <h2>í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
        <div id="testResults"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('testResults');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
            console.log(message);
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
        }

        function clearStorage() {
            // Clear session storage keys related to our test
            const keys = Object.keys(sessionStorage);
            keys.forEach(key => {
                if (key.startsWith('stats_api_called_')) {
                    sessionStorage.removeItem(key);
                }
            });
            log('ğŸ§¹ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }

        function simulateApiCall(sessionId) {
            // Simulate the duplicate prevention logic from gameStats.ts
            const apiCallKey = `stats_api_called_${sessionId}`;
            
            const alreadyCalled = sessionStorage.getItem(apiCallKey);
            if (alreadyCalled) {
                log(`âš ï¸ Stats API already called for session ${sessionId}, skipping duplicate call`, 'error');
                return false; // Call was blocked
            }
            
            // API í˜¸ì¶œ ê¸°ë¡
            sessionStorage.setItem(apiCallKey, Date.now().toString());
            log(`âœ… API call for session ${sessionId} proceeded`, 'success');
            return true; // Call proceeded
        }

        function runClientSideTest() {
            clearResults();
            log('ğŸ§ª í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì¤‘ë³µ ë°©ì§€ í…ŒìŠ¤íŠ¸ ì‹œì‘', 'info');
            
            const sessionId1 = 'test-session-' + Date.now();
            const sessionId2 = 'test-session-' + (Date.now() + 1000);
            
            // Test 1: First call should proceed
            log('ğŸ“ í…ŒìŠ¤íŠ¸ 1: ì²« ë²ˆì§¸ API í˜¸ì¶œ', 'info');
            const result1 = simulateApiCall(sessionId1);
            if (result1) {
                log('âœ… í…ŒìŠ¤íŠ¸ 1 ì„±ê³µ: ì²« ë²ˆì§¸ í˜¸ì¶œì´ ì§„í–‰ë¨', 'success');
            } else {
                log('âŒ í…ŒìŠ¤íŠ¸ 1 ì‹¤íŒ¨: ì²« ë²ˆì§¸ í˜¸ì¶œì´ ì°¨ë‹¨ë¨', 'error');
            }
            
            // Test 2: Duplicate call should be blocked
            log('ğŸ“ í…ŒìŠ¤íŠ¸ 2: ì¤‘ë³µ API í˜¸ì¶œ (ê°™ì€ ì„¸ì…˜)', 'info');
            const result2 = simulateApiCall(sessionId1);
            if (!result2) {
                log('âœ… í…ŒìŠ¤íŠ¸ 2 ì„±ê³µ: ì¤‘ë³µ í˜¸ì¶œì´ ì°¨ë‹¨ë¨', 'success');
            } else {
                log('âŒ í…ŒìŠ¤íŠ¸ 2 ì‹¤íŒ¨: ì¤‘ë³µ í˜¸ì¶œì´ ì§„í–‰ë¨', 'error');
            }
            
            // Test 3: Different session should proceed
            log('ğŸ“ í…ŒìŠ¤íŠ¸ 3: ìƒˆë¡œìš´ ì„¸ì…˜ìœ¼ë¡œ API í˜¸ì¶œ', 'info');
            const result3 = simulateApiCall(sessionId2);
            if (result3) {
                log('âœ… í…ŒìŠ¤íŠ¸ 3 ì„±ê³µ: ìƒˆ ì„¸ì…˜ í˜¸ì¶œì´ ì§„í–‰ë¨', 'success');
            } else {
                log('âŒ í…ŒìŠ¤íŠ¸ 3 ì‹¤íŒ¨: ìƒˆ ì„¸ì…˜ í˜¸ì¶œì´ ì°¨ë‹¨ë¨', 'error');
            }
            
            // Summary
            const allPassed = result1 && !result2 && result3;
            log(`\nğŸ¯ ì „ì²´ í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${allPassed ? 'âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼' : 'âŒ ì¼ë¶€ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨'}`, allPassed ? 'success' : 'error');
            
            if (allPassed) {
                log('\nğŸ‰ Championship wins ì¤‘ë³µ ë°©ì§€ ë¡œì§ì´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤!', 'success');
                log('ê° í† ë„ˆë¨¼íŠ¸ ì™„ë£Œ ì‹œ championship_winsê°€ ì •í™•íˆ 1ë²ˆë§Œ ì¦ê°€í•©ë‹ˆë‹¤.', 'info');
            }
        }

        // Auto-run test on page load
        window.onload = function() {
            log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ. í…ŒìŠ¤íŠ¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”.', 'info');
        };
    </script>
</body>
</html>